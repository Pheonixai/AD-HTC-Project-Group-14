<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AD-HTC Fuel-Enhanced Gas Cycle Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes flow {
            from { stroke-dashoffset: 20; }
            to { stroke-dashoffset: 0; }
        }
        .flow-line {
            stroke-dasharray: 5, 5;
            transition: stroke 0.3s ease;
        }
        /* Active state triggered by JS */
        .system-active .flow-line {
            animation: flow 1s linear infinite;
        }
        .schematic-container {
            position: relative;
            background: #0f172a; 
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #1e293b;
        }
        .input-group {
            position: absolute;
            display: flex;
            flex-direction: column;
            gap: 2px;
            z-index: 20;
        }
        .input-overlay {
            background: #1e293b;
            border: 1px solid #334155;
            color: #f8fafc;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: bold;
            width: 65px;
            outline: none;
        }
        .input-overlay:focus {
            border-color: #3b82f6;
            background: #0f172a;
        }
        .node-label {
            font-weight: 700;
            font-size: 9px;
            color: #94a3b8;
            text-transform: uppercase;
            pointer-events: none;
            white-space: nowrap;
        }
        .component-box rect, .component-box path {
            fill: #1e293b;
            stroke: #334155;
            stroke-width: 2;
        }
        .component-text {
            fill: #f8fafc;
            font-size: 10px;
            font-weight: bold;
            text-anchor: middle;
        }
    </style>
</head>
<body class="bg-slate-950 min-h-screen p-4 md:p-8 font-sans text-slate-200">

    <div class="max-w-7xl mx-auto space-y-6">
        <!-- Header -->
        <header class="bg-slate-900 p-6 rounded-2xl shadow-xl border border-slate-800 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="bg-blue-600 p-3 rounded-lg text-white">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </div>
                <div>
                    <h1 class="text-2xl font-extrabold tracking-tight">AD-HTC Fuel-Enhanced Gas Cycle</h1>
                    <p class="text-slate-400 font-medium italic">Integrated UI/UX State Property Analysis</p>
                </div>
            </div>
            <div class="flex flex-col items-end">
                <span class="text-xs font-bold text-blue-400 bg-blue-900/30 px-3 py-1 rounded-full border border-blue-800/50 mb-1">UNILAG ENERGY RESEARCH</span>
                <span class="text-[10px] font-mono text-slate-500">VERSION 2.4.0_THERMO</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            
            <!-- Schematic Canvas -->
            <div class="lg:col-span-3">
                <div id="main_canvas" class="schematic-container aspect-[16/9] w-full relative group">
                    <svg viewBox="0 0 800 450" class="w-full h-full">
                        <!-- MECHANICAL SHAFT -->
                        <line x1="380" y1="360" x2="640" y2="360" stroke="#475569" stroke-width="8" stroke-dasharray="12,4"/>
                        <line x1="380" y1="360" x2="640" y2="360" stroke="#94a3b8" stroke-width="2"/>

                        <!-- CONNECTION LINES -->
                        <path class="flow-line" d="M 40 70 L 120 70" stroke="#64748b" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 200 60 L 580 60 L 580 100" stroke="#8b5cf6" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 160 90 L 160 215 L 300 215" stroke="#f59e0b" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 320 130 L 320 180" stroke="#ef4444" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 380 180 L 380 130" stroke="#ef4444" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 400 215 L 485 215 L 485 240" stroke="#10b981" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 580 150 L 580 190 L 515 190 L 515 240" stroke="#10b981" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 500 290 L 500 310" stroke="#3b82f6" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 330 440 L 330 380" stroke="#94a3b8" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 380 350 L 435 350 L 435 310" stroke="#94a3b8" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 605 285 L 690 285 L 690 335" stroke="#ea580c" stroke-width="2" fill="none" />
                        <path class="flow-line" d="M 690 380 L 690 440" stroke="#475569" stroke-width="2" fill="none" />

                        <!-- COMPONENTS -->
                        <g class="component-box">
                            <rect x="120" y="45" width="80" height="50" rx="4"/>
                            <text x="160" y="73" class="component-text">HOMOGENIZER</text>
                        </g>
                        <g class="component-box">
                            <rect x="300" y="80" width="100" height="50" rx="4"/>
                            <text x="350" y="110" class="component-text" style="fill:#ef4444">BOILER</text>
                        </g>
                        <g class="component-box">
                            <rect x="300" y="180" width="100" height="55" rx="4"/>
                            <text x="350" y="212" class="component-text" style="fill:#10b981">REACTOR</text>
                        </g>
                        <g class="component-box">
                            <rect x="550" y="100" width="60" height="50" rx="4"/>
                            <text x="580" y="130" class="component-text" style="fill:#8b5cf6">AD</text>
                        </g>
                        <g class="component-box">
                            <rect x="470" y="240" width="60" height="50" rx="2" stroke-dasharray="4,2"/>
                            <text x="500" y="270" class="component-text" style="font-size: 80px">COLLECTOR</text>
                        </g>
                        <g class="component-box">
                            <path d="M435 310 L605 310 L605 260 L435 260 Z"/>
                            <text x="520" y="290" class="component-text" style="fill:#fb923c">COMBUSTION</text>
                        </g>
                        <g class="component-box">
                            <path d="M280 320 L380 335 L380 385 L280 400 Z"/>
                            <text x="330" y="365" class="component-text">COMPRESSOR</text>
                        </g>
                        <g class="component-box">
                            <path d="M640 335 L740 320 L740 400 L640 385 Z"/>
                            <text x="690" y="365" class="component-text">TURBINE</text>
                        </g>
                    </svg>

                    <!-- INPUT GROUPS AT APPROPRIATE PLACES -->
                    <!-- Feedstock Side -->
                    <div class="input-group" style="top: 20px; left: 15px;">
                        <div class="node-label">Biomass (kg/s)</div>
                        <input id="in_feed_mass" type="number" class="input-overlay" value="12">
                    </div>
                    <div class="input-group" style="top: 100px; left: 15px;">
                        <div class="node-label">Moisture (%)</div>
                        <input id="in_moisture" type="number" class="input-overlay" value="45">
                    </div>

                    <!-- Boiler Side -->
                    <div class="input-group" style="top: 20px; left: 300px;">
                        <div class="node-label">Boiler P (bar)</div>
                        <input id="in_boiler_p" type="number" class="input-overlay" value="25">
                    </div>
                    <div class="input-group" style="top: 20px; left: 380px;">
                        <div class="node-label">Boiler T (°C)</div>
                        <input id="in_boiler_t" type="number" class="input-overlay" value="350">
                    </div>

                    <!-- Compressor Side -->
                    <div class="input-group" style="top: 405px; left: 280px;">
                        <div class="node-label">Pressure Ratio</div>
                        <input id="in_comp_ratio" type="number" class="input-overlay" value="15">
                    </div>

                    <!-- Turbine Side -->
                    <div class="input-group" style="top: 230px; left: 640px;">
                        <div class="node-label">Turbine Inlet (K)</div>
                        <input id="in_tit" type="number" class="input-overlay" value="1450">
                    </div>
                </div>

                <div class="mt-4 flex justify-between items-center bg-slate-900 p-4 rounded-xl border border-slate-800">
                    <div id="status_msg" class="text-sm font-mono text-slate-500">> SYSTEM IDLE. WAITING FOR TRIGGER...</div>
                    <button id="analyze_btn" onclick="runSimulation()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-8 rounded-lg transition active:scale-95 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        ANALYZE SYSTEM
                    </button>
                </div>
            </div>

            <!-- Side Metrics -->
            <div class="space-y-6">
                <div class="bg-slate-900 p-5 rounded-2xl border border-slate-800">
                    <h3 class="text-xs font-black text-slate-500 uppercase tracking-widest mb-4">Core Analytics</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-xs font-bold mb-1">
                                <span class="text-slate-400">Thermal Efficiency</span>
                                <span id="res_eff" class="text-blue-400">0.00%</span>
                            </div>
                            <div class="h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                <div id="eff_bar" class="h-full bg-blue-500 transition-all duration-700" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="pt-4 border-t border-slate-800">
                            <span class="text-[10px] font-bold text-slate-500 uppercase">Power Delivery</span>
                            <div class="flex items-baseline gap-1">
                                <span id="res_pwr" class="text-2xl font-black text-white">0.00</span>
                                <span class="text-xs font-bold text-slate-500">MW</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-black/40 rounded-2xl p-4 border border-slate-800 h-[220px]">
                    <h3 class="text-[10px] font-black text-slate-600 uppercase mb-2">Process Log</h3>
                    <div id="log_box" class="font-mono text-[10px] text-slate-400 h-[170px] overflow-y-auto space-y-1 custom-scrollbar"></div>
                </div>
            </div>
        </div>

        <!-- Analytical Charts -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
                <h4 class="text-xs font-bold text-slate-400 uppercase mb-4">Enthalpy-Entropy ($h-s$)</h4>
                <canvas id="hsChart" class="max-h-[250px]"></canvas>
            </div>
            <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
                <h4 class="text-xs font-bold text-slate-400 uppercase mb-4">Temperature-Heat ($T-\dot{H}$)</h4>
                <canvas id="thChart" class="max-h-[250px]"></canvas>
            </div>
        </div>
    </div>

    <script>
        let hsChart, thChart;

        function initCharts() {
            const chartConfig = (label, color) => ({
                type: 'line',
                data: { datasets: [{ label, borderColor: color, backgroundColor: color + '22', borderWidth: 2, data: [], fill: true, tension: 0.3 }] },
                options: { 
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { 
                        x: { type: 'linear', grid: { color: '#1e293b' } }, 
                        y: { grid: { color: '#1e293b' } } 
                    } 
                }
            });

            hsChart = new Chart(document.getElementById('hsChart').getContext('2d'), chartConfig('Steam', '#ef4444'));
            thChart = new Chart(document.getElementById('thChart').getContext('2d'), chartConfig('Gas', '#3b82f6'));
        }

        function writeLog(msg, color = 'text-slate-400') {
            const box = document.getElementById('log_box');
            box.innerHTML += `<div class="${color}">> ${msg}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        async function runSimulation() {
            const canvas = document.getElementById('main_canvas');
            const btn = document.getElementById('analyze_btn');
            
            canvas.classList.add('system-active');
            btn.innerHTML = `<span class="animate-spin">◌</span> ANALYZING...`;
            document.getElementById('status_msg').innerText = "> ENGINE RUNNING. CALCULATING PROPERTIES...";
            document.getElementById('status_msg').classList.replace('text-slate-500', 'text-blue-400');

            const mass = parseFloat(document.getElementById('in_feed_mass').value);
            const moisture = parseFloat(document.getElementById('in_moisture').value);
            const pr = parseFloat(document.getElementById('in_comp_ratio').value);
            const tit = parseFloat(document.getElementById('in_tit').value);
            const bp = parseFloat(document.getElementById('in_boiler_p').value);
            const bt = parseFloat(document.getElementById('in_boiler_t').value);

            const cp_air = 1.005;
            const t1 = 298;
            const t2 = t1 * Math.pow(pr, 0.286);
            const t4 = tit / Math.pow(pr, 0.286);
            
            // Boiler Temp adds a minor efficiency boost but requires more fuel input
            const moisture_penalty = (moisture / 100) * 0.15; 
            const boiler_factor = (bt / 500) * 0.05; 
            const efficiency = ((1 - (1/Math.pow(pr, 0.286))) * (1 - moisture_penalty) + boiler_factor) * 100;
            const power = (mass * cp_air * ((tit - t4) - (t2 - t1))) * (1 - moisture_penalty) * (1 + (bt/1000));

            setTimeout(() => {
                writeLog(`MOISTURE LEVEL: ${moisture}%`, 'text-amber-400');
                writeLog(`BOILER STATE: ${bp} BAR / ${bt}°C`, 'text-blue-400');
                writeLog(`BRAYTON CYCLE WORK COMPUTED`, 'text-green-400');
                
                document.getElementById('res_eff').innerText = Math.min(65, efficiency).toFixed(2) + "%";
                document.getElementById('res_pwr').innerText = (power/10).toFixed(2);
                document.getElementById('eff_bar').style.width = Math.min(100, efficiency) + "%";

                updateCharts(t2, tit, t4, power, bt);

                btn.innerHTML = `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg> ANALYZE SYSTEM`;
                document.getElementById('status_msg').innerText = "> STEADY STATE REACHED.";
                document.getElementById('status_msg').classList.replace('text-blue-400', 'text-green-400');
            }, 800);
        }

        function updateCharts(t2, t3, t4, p, bt) {
            // Adjust steam chart based on boiler temp input
            const enthalpy_peak = 2500 + (bt * 2);
            hsChart.data.datasets[0].data = [
                {x: 1, y: 500}, 
                {x: 1.1, y: 600}, 
                {x: 5, y: enthalpy_peak}, 
                {x: 7.2, y: 2200}
            ];
            hsChart.update();
            
            const h = p / 10;
            thChart.data.datasets[0].data = [{x: 0, y: t2}, {x: h*0.4, y: t3*0.8}, {x: h*0.7, y: t3}, {x: h, y: t4}];
            thChart.update();
        }

        window.onload = () => {
            initCharts();
            writeLog("COLD START SUCCESSFUL.");
            writeLog("BOILER TEMPERATURE PARAMETER ADDED.");
        };
    </script>
</body>
</html>